{"ast":null,"code":"import { fotoList } from './foto-list';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"../help/help.component\";\nimport * as i3 from \"../map/map.component\";\nimport * as i4 from \"../admin/admin.component\";\nimport * as i5 from \"../ziel/ziel.component\";\nimport * as i6 from \"../hint/hint.component\";\nfunction FotoOlComponent_div_0_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"app-hint\", 5);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"hintText\", ctx_r6.getHint());\n  }\n}\nfunction FotoOlComponent_div_0_button_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function FotoOlComponent_div_0_button_7_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r8.getHint());\n    });\n    i0.ɵɵtext(1, \"Keine Ahnung wo das Foto aufgenommen wurde. Hilf mir auf die Spr\\u00FCnge\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FotoOlComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"img\", 2);\n    i0.ɵɵtemplate(4, FotoOlComponent_div_0_div_4_Template, 2, 1, \"div\", 0);\n    i0.ɵɵelementStart(5, \"p\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, FotoOlComponent_div_0_button_7_Template, 2, 0, \"button\", 3);\n    i0.ɵɵelement(8, \"br\")(9, \"br\");\n    i0.ɵɵelementStart(10, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function FotoOlComponent_div_0_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.setCurrentCoordinates());\n    });\n    i0.ɵɵtext(11, \"Ich bin am Punkt wo Fotografiert wurde\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" Wandere zur Position wo dieses Foto (\", ctx_r0.index + 1, \"/\", ctx_r0.photos.length, \") aufgenommen wurde. \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"src\", ctx_r0.getPhotoUrl(), i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showHint);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" Strafpunkte \", ctx_r0.result, \"m, Distanz zu letzem Foto \", ctx_r0.lastDistance, \"m \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.showHint);\n  }\n}\nfunction FotoOlComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"app-help\", 6);\n    i0.ɵɵlistener(\"teamName\", function FotoOlComponent_div_1_Template_app_help_teamName_1_listener($event) {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.setTeamName($event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction FotoOlComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function FotoOlComponent_div_2_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.start());\n    });\n    i0.ɵɵtext(2, \" Starte Foto-OL \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"title\", ctx_r2.teamName ? \"\" : \"zuerst Teamnamen eingeben\");\n    i0.ɵɵproperty(\"disabled\", ctx_r2.teamName == \"\");\n  }\n}\nfunction FotoOlComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function FotoOlComponent_div_3_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.nextPhoto());\n    });\n    i0.ɵɵtext(2, \"Ja diese Position ist OK\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"app-map\", 8);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"center\", ctx_r3.center);\n  }\n}\nfunction FotoOlComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelement(2, \"app-ziel\", 9);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Distanz zu letzem Foto \", ctx_r4.lastDistance, \"m \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"result\", ctx_r4.result)(\"teamName\", ctx_r4.teamName);\n  }\n}\nfunction FotoOlComponent_app_admin_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-admin\", 10);\n    i0.ɵɵlistener(\"adminPhoto\", function FotoOlComponent_app_admin_5_Template_app_admin_adminPhoto_0_listener($event) {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r18.addAdminPhoto($event));\n    })(\"clearPhotos\", function FotoOlComponent_app_admin_5_Template_app_admin_clearPhotos_0_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.clearPhotos());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\nexport class FotoOlComponent {\n  constructor() {\n    this.teamName = '';\n    this.photos = fotoList.photos;\n    // Index des zu suchenden Fotos\n    this.index = 0;\n    // aktuelle Koordinaten mit o,o initialisieren\n    this.center = {\n      lng: 0,\n      lat: 0\n    };\n    // Strafpunkte (Summe der Distanz in Meter von den Foto-Koordinaten).\n    this.result = 0;\n    this.lastDistance = 0;\n    //Konfiguration\n    this.skipMap = true;\n    this.HINT_PENALTY = 10;\n    // Ablaufsteuerung\n    this.showHelp = true;\n    this.hasStarted = false;\n    this.showFotos = false;\n    this.showMap = false;\n    this.showHint = false;\n    this.amZiel = false;\n    this.showAdmin = false;\n  }\n  /** wird von HelpComponent.setTeamName() bei jedem Buchstaben vom Input aufgerufen.\n   *\n   * @param teamName\n   */\n  setTeamName(teamName) {\n    this.teamName = teamName;\n    if (teamName === 'admin') {\n      this.showAdmin = true;\n      this.showHelp = false;\n    }\n  }\n  /** OL Starten */\n  start() {\n    if (this.teamName != '') {\n      this.showHelp = false;\n      this.hasStarted = true;\n      this.showFotos = true;\n      this.showAdmin = false;\n    }\n  }\n  /** URL zum aktuellen Bild. */\n  getPhotoUrl() {\n    return this.photos[this.index].photoUrl;\n  }\n  /** Aktuelle Koordinaten speichern. */\n  setCurrentCoordinates() {\n    navigator.geolocation.getCurrentPosition(position => {\n      this.center = {\n        lat: position.coords.latitude,\n        lng: position.coords.longitude\n      };\n      //      console.log(\"setCurrentCoordinates center:\",this.center);\n      if (this.skipMap) {\n        this.nextPhoto();\n      } else {\n        this.showMap = true;\n      }\n    });\n  }\n  /** nächstes Foto anzeigen */\n  nextPhoto() {\n    this.showHint = false;\n    this.lastDistance = this.getDistanceFromLatLonInM();\n    this.result += this.lastDistance;\n    this.showMap = false;\n    this.index++;\n    if (this.index >= this.photos.length) {\n      this.amZiel = true;\n      this.showFotos = false;\n    }\n  }\n  /** Hilfetext anzeigen\n   * Strafpunkte zum resultat hinzufügen\n   */\n  getHint() {\n    if (!this.showHint) {\n      this.result += this.HINT_PENALTY;\n    }\n    this.showHint = true;\n    return this.photos[this.index].hint;\n  }\n  /** Bereschne die Distanz von deinem Standpunkt zu dem Foto\n   *\n   */\n  getDistanceFromLatLonInM() {\n    const r = 6373.0;\n    const lat1 = this.center?.lat;\n    const lat2 = this.photos[this.index].coordinates.lat;\n    const lon1 = this.center?.lng;\n    const lon2 = this.photos[this.index].coordinates.lng;\n    const R = 6371; // Radius of the earth in km\n    const dLat = this.deg2rad(lat2 - lat1); // deg2rad below\n    const dLon = this.deg2rad(lon2 - lon1);\n    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(this.deg2rad(lat1)) * Math.cos(this.deg2rad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    const d = R * c; // Distance in km\n    return Math.trunc(d * 1000);\n  }\n  deg2rad(deg) {\n    return deg * (Math.PI / 180);\n  }\n  addAdminPhoto(photo) {\n    this.photos.push(photo);\n  }\n  clearPhotos() {\n    this.photos = [];\n  }\n}\nFotoOlComponent.ɵfac = function FotoOlComponent_Factory(t) {\n  return new (t || FotoOlComponent)();\n};\nFotoOlComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: FotoOlComponent,\n  selectors: [[\"app-foto-ol\"]],\n  decls: 6,\n  vars: 6,\n  consts: [[4, \"ngIf\"], [3, \"adminPhoto\", \"clearPhotos\", 4, \"ngIf\"], [\"height\", \"300px\", \"alt\", \"\", 3, \"src\"], [\"class\", \"button\", 3, \"click\", 4, \"ngIf\"], [1, \"button\", 3, \"click\"], [3, \"hintText\"], [3, \"teamName\"], [1, \"button\", 3, \"disabled\", \"title\", \"click\"], [3, \"center\"], [3, \"result\", \"teamName\"], [3, \"adminPhoto\", \"clearPhotos\"]],\n  template: function FotoOlComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, FotoOlComponent_div_0_Template, 12, 7, \"div\", 0);\n      i0.ɵɵtemplate(1, FotoOlComponent_div_1_Template, 2, 0, \"div\", 0);\n      i0.ɵɵtemplate(2, FotoOlComponent_div_2_Template, 3, 2, \"div\", 0);\n      i0.ɵɵtemplate(3, FotoOlComponent_div_3_Template, 4, 1, \"div\", 0);\n      i0.ɵɵtemplate(4, FotoOlComponent_div_4_Template, 3, 3, \"div\", 0);\n      i0.ɵɵtemplate(5, FotoOlComponent_app_admin_5_Template, 1, 0, \"app-admin\", 1);\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.showFotos);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.showHelp);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.hasStarted);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.showMap);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.amZiel);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.showAdmin);\n    }\n  },\n  dependencies: [i1.NgIf, i2.HelpComponent, i3.MapComponent, i4.AdminComponent, i5.ZielComponent, i6.HintComponent],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["fotoList","i0","FotoOlComponent","constructor","photos","lng","lat","setTeamName","teamName","showAdmin","showHelp","start","hasStarted","showFotos","getPhotoUrl","index","photoUrl","setCurrentCoordinates","navigator","geolocation","getCurrentPosition","position","center","coords","latitude","longitude","skipMap","nextPhoto","showMap","showHint","lastDistance","getDistanceFromLatLonInM","result","length","amZiel","getHint","HINT_PENALTY","hint","r","lat1","lat2","coordinates","lon1","lon2","R","dLat","deg2rad","dLon","a","Math","sin","cos","c","atan2","sqrt","d","trunc","deg","PI","addAdminPhoto","photo","push","clearPhotos","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["/Users/xander/git.FotoOL/FotoOL/src/app/foto-ol/foto-ol.component.ts","/Users/xander/git.FotoOL/FotoOL/src/app/foto-ol/foto-ol.component.html"],"sourcesContent":["import { Component, Input } from '@angular/core';\nimport { fotoList } from './foto-list';\n\n@Component({\n  selector: 'app-foto-ol',\n  templateUrl: './foto-ol.component.html',\n  styleUrls: ['./foto-ol.component.css']\n})\nexport class FotoOlComponent {\n  teamName: string = '';\n\n  photos = fotoList.photos;\n  // Index des zu suchenden Fotos\n  index = 0;\n\n  // aktuelle Koordinaten mit o,o initialisieren\n  center: { lng: number; lat: number; } = {lng: 0, lat: 0};\n  // Strafpunkte (Summe der Distanz in Meter von den Foto-Koordinaten).\n  result = 0;\n  lastDistance = 0;\n\n  //Konfiguration\n  skipMap = true;\n  HINT_PENALTY: number = 10;\n\n  // Ablaufsteuerung\n  showHelp = true;\n  hasStarted = false;\n  showFotos = false;\n  showMap = false;\n  showHint = false;\n  amZiel = false;\n  showAdmin =false;\n\n  /** wird von HelpComponent.setTeamName() bei jedem Buchstaben vom Input aufgerufen.\n   *\n   * @param teamName\n   */\n  setTeamName(teamName: string) {\n    this.teamName = teamName;\n    if (teamName === 'admin') {\n      this.showAdmin = true;\n      this.showHelp =false;\n    }\n  }\n\n  /** OL Starten */\n  start() {\n    if (this.teamName != '') {\n      this.showHelp = false;\n      this.hasStarted = true;\n      this.showFotos = true;\n      this.showAdmin = false;\n    }\n  }\n\n  /** URL zum aktuellen Bild. */\n  getPhotoUrl() {\n    return (this.photos)[this.index].photoUrl;\n  }\n\n  /** Aktuelle Koordinaten speichern. */\n  setCurrentCoordinates() {\n    navigator.geolocation.getCurrentPosition((position) => {\n      this.center = {\n        lat: position.coords.latitude,\n        lng: position.coords.longitude,\n      };\n//      console.log(\"setCurrentCoordinates center:\",this.center);\n\n      if (this.skipMap) {\n        this.nextPhoto();\n      } else {\n        this.showMap = true;\n      }\n    });\n  }\n\n  /** nächstes Foto anzeigen */\n  nextPhoto() {\n    this.showHint = false;\n    this.lastDistance = this.getDistanceFromLatLonInM();\n    this.result += this.lastDistance;\n    this.showMap = false;\n\n    this.index ++;\n    if (this.index >= this.photos.length) {\n      this.amZiel = true;\n      this.showFotos = false;\n    }\n  }\n\n  /** Hilfetext anzeigen\n   * Strafpunkte zum resultat hinzufügen\n   */\n  getHint() {\n    if (!this.showHint) {\n      this.result += this.HINT_PENALTY;\n    }\n    this.showHint = true;\n    return (this.photos)[this.index].hint;\n  }\n\n  /** Bereschne die Distanz von deinem Standpunkt zu dem Foto\n   *\n   */\n  getDistanceFromLatLonInM() {\n    const r = 6373.0;\n    const lat1 = this.center?.lat;\n    const lat2 = this.photos[this.index].coordinates.lat;\n    const lon1 = this.center?.lng;\n    const lon2 = this.photos[this.index].coordinates.lng;\n\n    const R = 6371; // Radius of the earth in km\n    const dLat = this.deg2rad(lat2 - lat1);  // deg2rad below\n    const dLon = this.deg2rad(lon2 - lon1);\n    const a =\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos(this.deg2rad(lat1)) * Math.cos(this.deg2rad(lat2)) *\n      Math.sin(dLon / 2) * Math.sin(dLon / 2)\n    ;\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    const d = R * c; // Distance in km\n    return Math.trunc(d * 1000);\n  }\n\n  deg2rad(deg: number) {\n    return deg * (Math.PI/180)\n  }\n\n  addAdminPhoto(photo: any) {\n    this.photos.push(photo);\n  }\n\n  clearPhotos() {\n    this.photos = [];\n  }\n}\n","<div *ngIf=\"showFotos\">\n  <p>\n    Wandere zur Position wo dieses Foto ({{index+1}}/{{photos.length}}) aufgenommen wurde.\n  </p>\n  <img src=\"{{getPhotoUrl()}}\" height=\"300px\" alt=\"\"/>\n\n\n  <div *ngIf=\"showHint\">\n    <app-hint [hintText]=\"getHint()\"></app-hint>\n  </div>\n\n  <p>\n    Strafpunkte {{result}}m,\n    Distanz zu letzem Foto {{lastDistance}}m\n  </p>\n\n  <button *ngIf=\"!showHint\" (click)=\"getHint()\"class=\"button\">Keine Ahnung wo das Foto aufgenommen wurde. Hilf mir auf die Sprünge</button>\n  <br><br>\n  <button (click)=\"setCurrentCoordinates()\" class=\"button\">Ich bin am Punkt wo Fotografiert wurde</button>\n</div>\n\n<div *ngIf=\"showHelp\">\n  <app-help (teamName)=\"setTeamName($event)\"></app-help>\n</div>\n\n<div *ngIf=\"!hasStarted \">\n  <button (click)=\"start()\"\n          class=\"button\"\n          [disabled]=\"teamName == ''\"\n          title=\"{{teamName?'':'zuerst Teamnamen eingeben'}}\">\n    Starte Foto-OL\n  </button>\n</div>\n\n<div *ngIf=\"showMap\">\n  <button (click)=\"nextPhoto()\" class=\"button\">Ja diese Position ist OK</button>\n  <app-map [center]=\"center\"></app-map>\n</div>\n\n<div *ngIf=\"amZiel\">\n  Distanz zu letzem Foto {{lastDistance}}m\n  <app-ziel [result]=result [teamName]=\"teamName\"></app-ziel>\n</div>\n\n<app-admin \n  *ngIf=\"showAdmin\"\n  (adminPhoto)=\"addAdminPhoto($event)\"\n  (clearPhotos)=\"clearPhotos()\"\n  >\n</app-admin>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}